
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>AirQuality Prediction &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Saket Medhalavalasa" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Saket Medhalavalasa
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">AirQuality Prediction</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>AirQuality Prediction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="airquality-prediction">
<h1>AirQuality Prediction<a class="headerlink" href="#airquality-prediction" title="Link to this heading">#</a></h1>
<p>========================</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1"># File path to the dataset</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;updated_pollution_dataset.csv&quot;</span>

<span class="c1"># Step 1: Normalize the dataset</span>
<span class="n">locations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">measurements</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">location_id_counter</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">measurement_id_counter</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">link_table</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Read the CSV file and normalize data</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="c1"># Create Location Table</span>
        <span class="n">location_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Proximity_to_Industrial_Areas&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Population_Density&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">location_tuple</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
            <span class="n">locations</span><span class="p">[</span><span class="n">location_tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_id_counter</span>
            <span class="n">location_id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">location_id</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">location_tuple</span><span class="p">]</span>

        <span class="c1"># Create Air Quality Table</span>
        <span class="n">measurement_tuple</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Humidity&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PM2.5&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PM10&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;NO2&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;SO2&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CO&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Air Quality&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">measurement_tuple</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
            <span class="n">measurements</span><span class="p">[</span><span class="n">measurement_tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">measurement_id_counter</span>
            <span class="n">measurement_id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">measurement_id</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="n">measurement_tuple</span><span class="p">]</span>

        <span class="c1"># Add to Link Table</span>
        <span class="n">link_table</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">location_id</span><span class="p">,</span> <span class="n">measurement_id</span><span class="p">))</span>

<span class="c1"># Save normalized tables to SQLite</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;pollution_data_normalized.db&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="c1"># Location Table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS Location (</span>
<span class="s2">                Location_ID INTEGER PRIMARY KEY,</span>
<span class="s2">                Proximity_to_Industrial_Areas REAL,</span>
<span class="s2">                Population_Density REAL</span>
<span class="s2">            )</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">location</span><span class="p">,</span> <span class="n">loc_id</span> <span class="ow">in</span> <span class="n">locations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO Location (Location_ID, Proximity_to_Industrial_Areas, Population_Density)</span>
<span class="s2">                VALUES (?, ?, ?)</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">loc_id</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># Air Quality Table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS AirQuality (</span>
<span class="s2">                Measurement_ID INTEGER PRIMARY KEY,</span>
<span class="s2">                Temperature REAL,</span>
<span class="s2">                Humidity REAL,</span>
<span class="s2">                PM2_5 REAL,</span>
<span class="s2">                PM10 REAL,</span>
<span class="s2">                NO2 REAL,</span>
<span class="s2">                SO2 REAL,</span>
<span class="s2">                CO REAL,</span>
<span class="s2">                Air_Quality TEXT</span>
<span class="s2">            )</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">measurement</span><span class="p">,</span> <span class="n">meas_id</span> <span class="ow">in</span> <span class="n">measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO AirQuality (Measurement_ID, Temperature, Humidity, PM2_5, PM10, NO2, SO2, CO, Air_Quality)</span>
<span class="s2">                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">meas_id</span><span class="p">,</span> <span class="o">*</span><span class="n">measurement</span><span class="p">))</span>

        <span class="c1"># LocationAirQuality Link Table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS LocationAirQuality (</span>
<span class="s2">                Location_ID INTEGER,</span>
<span class="s2">                Measurement_ID INTEGER,</span>
<span class="s2">                PRIMARY KEY (Location_ID, Measurement_ID),</span>
<span class="s2">                FOREIGN KEY (Location_ID) REFERENCES Location(Location_ID),</span>
<span class="s2">                FOREIGN KEY (Measurement_ID) REFERENCES AirQuality(Measurement_ID)</span>
<span class="s2">            )</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            INSERT INTO LocationAirQuality (Location_ID, Measurement_ID)</span>
<span class="s2">            VALUES (?, ?)</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">link_table</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized database created successfully!&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while creating the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">15</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">link_table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># Read the CSV file and normalize data</span>
<span class="ne">---&gt; </span><span class="mi">15</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>         <span class="c1"># Create Location Table</span>

<span class="nn">File ~\anaconda3\envs\portfolio\Lib\site-packages\IPython\core\interactiveshell.py:324,</span> in <span class="ni">_modified_open</span><span class="nt">(file, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span> <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}:</span>
<span class="g g-Whitespace">    </span><span class="mi">318</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span>         <span class="sa">f</span><span class="s2">&quot;IPython won&#39;t let you open fd=</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> by default &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">320</span>         <span class="s2">&quot;as it is likely to crash IPython. If you know what you are doing, &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span>         <span class="s2">&quot;you can use builtins&#39; open.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">322</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">324</span> <span class="k">return</span> <span class="n">io_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;updated_pollution_dataset.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Step-3</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Define the SQL query to join normalized tables and fetch data</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT </span>
<span class="s2">    loc.Proximity_to_Industrial_Areas, </span>
<span class="s2">    loc.Population_Density, </span>
<span class="s2">    air.Temperature, </span>
<span class="s2">    air.Humidity, </span>
<span class="s2">    air.PM2_5 AS PM2_5, </span>
<span class="s2">    air.PM10 AS PM10, </span>
<span class="s2">    air.NO2, </span>
<span class="s2">    air.SO2, </span>
<span class="s2">    air.CO, </span>
<span class="s2">    air.Air_Quality</span>
<span class="s2">FROM </span>
<span class="s2">    LocationAirQuality AS link</span>
<span class="s2">JOIN </span>
<span class="s2">    Location AS loc ON link.Location_ID = loc.Location_ID</span>
<span class="s2">JOIN </span>
<span class="s2">    AirQuality AS air ON link.Measurement_ID = air.Measurement_ID;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Connect to the SQLite database and fetch data</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;pollution_data_normalized.db&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="c1"># Execute the query and load the result into a Pandas DataFrame</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data successfully fetched and loaded into a Pandas DataFrame.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>  <span class="c1"># Display the first few rows of the DataFrame</span>
        
        <span class="c1"># Save the data to a CSV file for downstream steps</span>
        <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data saved to &#39;data_from_step_2.csv&#39;.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while fetching data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">smpl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data successfully fetched and loaded into a Pandas DataFrame.
   Proximity_to_Industrial_Areas  Population_Density  Temperature  Humidity  \
0                            6.3               319.0         29.8      59.1   
1                            6.0               611.0         28.3      75.6   
2                            5.2               619.0         23.1      74.7   
3                           11.1               551.0         27.1      39.1   
4                           12.7               303.0         26.5      70.7   

   PM2_5  PM10   NO2   SO2    CO Air_Quality  
0    5.2  17.9  18.9   9.2  1.72    Moderate  
1    2.3  12.2  30.8   9.7  1.64    Moderate  
2   26.7  33.8  24.4  12.6  1.63    Moderate  
3    6.1   6.3  13.5   5.3  1.15        Good  
4    6.9  16.0  21.9   5.6  1.01        Good  
Data saved to &#39;data_from_step_2.csv&#39;.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#step-3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Load the data from Step-2</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with the correct file name if different</span>

<span class="c1"># Display the first few rows of the data</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First few rows of the dataset:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Explore the class distribution of the target variable</span>
<span class="n">target_column</span> <span class="o">=</span> <span class="s2">&quot;Air_Quality&quot;</span>  <span class="c1"># Ensure this matches your target variable name</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Distribution of the target variable:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="c1"># Plot the class distribution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">data</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;skyblue&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of Target Variable (Air Quality)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Air Quality Levels&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Check if stratification is needed</span>
<span class="n">class_distribution</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Class distribution in the entire dataset (as percentages):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">class_distribution</span><span class="p">)</span>

<span class="c1"># Stratified train/test split</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_column</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="c1"># Verify the stratification</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Class distribution in the training set:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Class distribution in the testing set:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Display EDA output to confirm consistency</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot training set distribution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Class Distribution in Training Set&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Air Quality Levels&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># Plot testing set distribution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;salmon&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Class Distribution in Testing Set&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Air Quality Levels&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First few rows of the dataset:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Proximity_to_Industrial_Areas</th>
      <th>Population_Density</th>
      <th>Temperature</th>
      <th>Humidity</th>
      <th>PM2_5</th>
      <th>PM10</th>
      <th>NO2</th>
      <th>SO2</th>
      <th>CO</th>
      <th>Air_Quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6.3</td>
      <td>319.0</td>
      <td>29.8</td>
      <td>59.1</td>
      <td>5.2</td>
      <td>17.9</td>
      <td>18.9</td>
      <td>9.2</td>
      <td>1.72</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6.0</td>
      <td>611.0</td>
      <td>28.3</td>
      <td>75.6</td>
      <td>2.3</td>
      <td>12.2</td>
      <td>30.8</td>
      <td>9.7</td>
      <td>1.64</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.2</td>
      <td>619.0</td>
      <td>23.1</td>
      <td>74.7</td>
      <td>26.7</td>
      <td>33.8</td>
      <td>24.4</td>
      <td>12.6</td>
      <td>1.63</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.1</td>
      <td>551.0</td>
      <td>27.1</td>
      <td>39.1</td>
      <td>6.1</td>
      <td>6.3</td>
      <td>13.5</td>
      <td>5.3</td>
      <td>1.15</td>
      <td>Good</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12.7</td>
      <td>303.0</td>
      <td>26.5</td>
      <td>70.7</td>
      <td>6.9</td>
      <td>16.0</td>
      <td>21.9</td>
      <td>5.6</td>
      <td>1.01</td>
      <td>Good</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Distribution of the target variable:
Air_Quality
Good         2000
Moderate     1500
Poor         1000
Hazardous     500
Name: count, dtype: int64
</pre></div>
</div>
<img alt="_images/f299eaacee0b4ea01078e0f2877c4cd804ca4cae53216fe3330a5599d9c1a9aa.png" src="_images/f299eaacee0b4ea01078e0f2877c4cd804ca4cae53216fe3330a5599d9c1a9aa.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Class distribution in the entire dataset (as percentages):
Air_Quality
Good         0.4
Moderate     0.3
Poor         0.2
Hazardous    0.1
Name: proportion, dtype: float64

Class distribution in the training set:
Air_Quality
Good         0.4
Moderate     0.3
Poor         0.2
Hazardous    0.1
Name: proportion, dtype: float64

Class distribution in the testing set:
Air_Quality
Good         0.4
Moderate     0.3
Poor         0.2
Hazardous    0.1
Name: proportion, dtype: float64
</pre></div>
</div>
<img alt="_images/4e5bc0e36d9b7fe2db6aaf67e8cae042eb97914bf76da759eb4ecbab32276c45.png" src="_images/4e5bc0e36d9b7fe2db6aaf67e8cae042eb97914bf76da759eb4ecbab32276c45.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>ydata-profiling
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>matplotlib<span class="w"> </span>seaborn
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pandas
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>numpy
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>ipywidgets
<span class="o">!</span>jupyter<span class="w"> </span>nbextension<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--py<span class="w"> </span>widgetsnbextension
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: ydata-profiling in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (4.12.1)
Requirement already satisfied: scipy&lt;1.14,&gt;=1.4.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (1.13.1)
Requirement already satisfied: pandas!=1.4.0,&lt;3,&gt;1.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (2.2.3)
Requirement already satisfied: matplotlib&lt;3.10,&gt;=3.5 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (3.9.2)
Requirement already satisfied: pydantic&gt;=2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (2.10.4)
Requirement already satisfied: PyYAML&lt;6.1,&gt;=5.0.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (6.0.2)
Requirement already satisfied: jinja2&lt;3.2,&gt;=2.11.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (3.1.4)
Requirement already satisfied: visions&lt;0.7.7,&gt;=0.7.5 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from visions[type_image_path]&lt;0.7.7,&gt;=0.7.5-&gt;ydata-profiling) (0.7.6)
Requirement already satisfied: numpy&lt;2.2,&gt;=1.16.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (2.0.2)
Requirement already satisfied: htmlmin==0.1.12 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (0.1.12)
Requirement already satisfied: phik&lt;0.13,&gt;=0.11.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (0.12.4)
Requirement already satisfied: requests&lt;3,&gt;=2.24.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (2.32.3)
Requirement already satisfied: tqdm&lt;5,&gt;=4.48.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (4.67.1)
Requirement already satisfied: seaborn&lt;0.14,&gt;=0.10.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (0.13.2)
Requirement already satisfied: multimethod&lt;2,&gt;=1.4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (1.12)
Requirement already satisfied: statsmodels&lt;1,&gt;=0.13.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (0.14.4)
Requirement already satisfied: typeguard&lt;5,&gt;=3 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (4.4.1)
Requirement already satisfied: imagehash==4.3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (4.3.1)
Requirement already satisfied: wordcloud&gt;=1.9.3 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (1.9.4)
Requirement already satisfied: dacite&gt;=1.8 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (1.8.1)
Requirement already satisfied: numba&lt;1,&gt;=0.56.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ydata-profiling) (0.60.0)
Requirement already satisfied: PyWavelets in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from imagehash==4.3.1-&gt;ydata-profiling) (1.8.0)
Requirement already satisfied: pillow in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from imagehash==4.3.1-&gt;ydata-profiling) (10.4.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from jinja2&lt;3.2,&gt;=2.11.1-&gt;ydata-profiling) (2.1.5)
Requirement already satisfied: contourpy&gt;=1.0.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (1.3.0)
Requirement already satisfied: cycler&gt;=0.10 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (4.54.1)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (1.4.7)
Requirement already satisfied: packaging&gt;=20.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (24.1)
Requirement already satisfied: pyparsing&gt;=2.3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (3.1.4)
Requirement already satisfied: python-dateutil&gt;=2.7 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (2.9.0.post0)
Requirement already satisfied: llvmlite&lt;0.44,&gt;=0.43.0dev0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from numba&lt;1,&gt;=0.56.0-&gt;ydata-profiling) (0.43.0)
Requirement already satisfied: pytz&gt;=2020.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas!=1.4.0,&lt;3,&gt;1.1-&gt;ydata-profiling) (2024.2)
Requirement already satisfied: tzdata&gt;=2022.7 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas!=1.4.0,&lt;3,&gt;1.1-&gt;ydata-profiling) (2024.2)
Requirement already satisfied: joblib&gt;=0.14.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from phik&lt;0.13,&gt;=0.11.1-&gt;ydata-profiling) (1.4.2)
Requirement already satisfied: annotated-types&gt;=0.6.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pydantic&gt;=2-&gt;ydata-profiling) (0.7.0)
Requirement already satisfied: pydantic-core==2.27.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pydantic&gt;=2-&gt;ydata-profiling) (2.27.2)
Requirement already satisfied: typing-extensions&gt;=4.12.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pydantic&gt;=2-&gt;ydata-profiling) (4.12.2)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from requests&lt;3,&gt;=2.24.0-&gt;ydata-profiling) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from requests&lt;3,&gt;=2.24.0-&gt;ydata-profiling) (3.8)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from requests&lt;3,&gt;=2.24.0-&gt;ydata-profiling) (2.2.2)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from requests&lt;3,&gt;=2.24.0-&gt;ydata-profiling) (2024.8.30)
Requirement already satisfied: patsy&gt;=0.5.6 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from statsmodels&lt;1,&gt;=0.13.2-&gt;ydata-profiling) (1.0.1)
Requirement already satisfied: colorama in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from tqdm&lt;5,&gt;=4.48.2-&gt;ydata-profiling) (0.4.6)
Requirement already satisfied: attrs&gt;=19.3.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from visions&lt;0.7.7,&gt;=0.7.5-&gt;visions[type_image_path]&lt;0.7.7,&gt;=0.7.5-&gt;ydata-profiling) (24.2.0)
Requirement already satisfied: networkx&gt;=2.4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from visions&lt;0.7.7,&gt;=0.7.5-&gt;visions[type_image_path]&lt;0.7.7,&gt;=0.7.5-&gt;ydata-profiling) (3.4.2)
Requirement already satisfied: six&gt;=1.5 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from python-dateutil&gt;=2.7-&gt;matplotlib&lt;3.10,&gt;=3.5-&gt;ydata-profiling) (1.16.0)
Requirement already satisfied: matplotlib in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (3.9.2)
Requirement already satisfied: seaborn in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (0.13.2)
Requirement already satisfied: contourpy&gt;=1.0.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (1.3.0)
Requirement already satisfied: cycler&gt;=0.10 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (4.54.1)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (1.4.7)
Requirement already satisfied: numpy&gt;=1.23 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (2.0.2)
Requirement already satisfied: packaging&gt;=20.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (24.1)
Requirement already satisfied: pillow&gt;=8 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (10.4.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (3.1.4)
Requirement already satisfied: python-dateutil&gt;=2.7 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib) (2.9.0.post0)
Requirement already satisfied: pandas&gt;=1.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from seaborn) (2.2.3)
Requirement already satisfied: pytz&gt;=2020.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas&gt;=1.2-&gt;seaborn) (2024.2)
Requirement already satisfied: tzdata&gt;=2022.7 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas&gt;=1.2-&gt;seaborn) (2024.2)
Requirement already satisfied: six&gt;=1.5 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from python-dateutil&gt;=2.7-&gt;matplotlib) (1.16.0)
Requirement already satisfied: pandas in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (2.2.3)
Requirement already satisfied: numpy&gt;=1.26.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas) (2.0.2)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas) (2024.2)
Requirement already satisfied: tzdata&gt;=2022.7 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas) (2024.2)
Requirement already satisfied: six&gt;=1.5 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from python-dateutil&gt;=2.8.2-&gt;pandas) (1.16.0)
Requirement already satisfied: numpy in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (2.0.2)
Requirement already satisfied: ipywidgets in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (8.1.5)
Requirement already satisfied: comm&gt;=0.1.3 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipywidgets) (0.2.2)
Requirement already satisfied: ipython&gt;=6.1.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipywidgets) (8.27.0)
Requirement already satisfied: traitlets&gt;=4.3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipywidgets) (5.14.3)
Requirement already satisfied: widgetsnbextension~=4.0.12 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipywidgets) (4.0.13)
Requirement already satisfied: jupyterlab-widgets~=3.0.12 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipywidgets) (3.0.13)
Requirement already satisfied: decorator in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipython&gt;=6.1.0-&gt;ipywidgets) (5.1.1)
Requirement already satisfied: jedi&gt;=0.16 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipython&gt;=6.1.0-&gt;ipywidgets) (0.19.1)
Requirement already satisfied: matplotlib-inline in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipython&gt;=6.1.0-&gt;ipywidgets) (0.1.7)
Requirement already satisfied: prompt-toolkit&lt;3.1.0,&gt;=3.0.41 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipython&gt;=6.1.0-&gt;ipywidgets) (3.0.47)
Requirement already satisfied: pygments&gt;=2.4.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipython&gt;=6.1.0-&gt;ipywidgets) (2.18.0)
Requirement already satisfied: stack-data in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipython&gt;=6.1.0-&gt;ipywidgets) (0.6.3)
Requirement already satisfied: colorama in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from ipython&gt;=6.1.0-&gt;ipywidgets) (0.4.6)
Requirement already satisfied: parso&lt;0.9.0,&gt;=0.8.3 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from jedi&gt;=0.16-&gt;ipython&gt;=6.1.0-&gt;ipywidgets) (0.8.4)
Requirement already satisfied: wcwidth in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from prompt-toolkit&lt;3.1.0,&gt;=3.0.41-&gt;ipython&gt;=6.1.0-&gt;ipywidgets) (0.2.13)
Requirement already satisfied: executing&gt;=1.2.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from stack-data-&gt;ipython&gt;=6.1.0-&gt;ipywidgets) (2.1.0)
Requirement already satisfied: asttokens&gt;=2.1.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from stack-data-&gt;ipython&gt;=6.1.0-&gt;ipywidgets) (2.4.1)
Requirement already satisfied: pure-eval in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from stack-data-&gt;ipython&gt;=6.1.0-&gt;ipywidgets) (0.2.3)
Requirement already satisfied: six&gt;=1.12.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from asttokens&gt;=2.1.0-&gt;stack-data-&gt;ipython&gt;=6.1.0-&gt;ipywidgets) (1.16.0)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>usage: jupyter [-h] [--version] [--config-dir] [--data-dir] [--runtime-dir]
               [--paths] [--json] [--debug]
               [subcommand]

Jupyter: Interactive Computing

positional arguments:
  subcommand     the subcommand to launch

options:
  -h, --help     show this help message and exit
  --version      show the versions of core jupyter packages and exit
  --config-dir   show Jupyter config dir
  --data-dir     show Jupyter data dir
  --runtime-dir  show Jupyter runtime dir
  --paths        show all Jupyter paths. Add --json for machine-readable
                 format.
  --json         output paths as machine-readable json
  --debug        output debug information about paths

Available subcommands: dejavu events execute kernel kernelspec lab
labextension labhub migrate nbconvert notebook run server troubleshoot trust

Jupyter command `jupyter-nbextension` not found.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#step-4</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ydata_profiling</span> <span class="kn">import</span> <span class="n">ProfileReport</span>

<span class="c1"># Load the dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with the correct file name</span>

<span class="c1"># Display the first few rows of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First few rows of the dataset:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Step 1: Convert the target variable (Air_Quality) to numeric codes</span>
<span class="c1"># Map categorical values in the &#39;Air_Quality&#39; column to numerical values</span>
<span class="n">air_quality_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Poor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Hazardous&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">air_quality_mapping</span><span class="p">)</span>

<span class="c1"># Step 2: Generate and display the ydata profiling report in the notebook</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Data Profiling Report&quot;</span><span class="p">,</span> <span class="n">explorative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_widgets</span><span class="p">()</span>  <span class="c1"># Display the profiling report directly in the notebook</span>

<span class="c1"># Step 3: Check for missing values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Missing Values in Each Column:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="c1"># Step 4: Generate and visualize the correlation matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix Heatmap&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;correlation_matrix.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Step 5: Observations</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Observations:&quot;</span><span class="p">)</span>
<span class="c1"># Example Observations</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Check for high correlations (e.g., PM2.5 and PM10).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Identify missing values in certain columns.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Check if distributions of features like CO or SO2 are skewed or capped.&quot;</span><span class="p">)</span>

<span class="c1"># Step 6: Create a list of data cleanup tasks</span>
<span class="n">cleanup_tasks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Handle missing values in columns with non-zero missing counts.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Normalize features with high variance.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Remove highly correlated features to avoid multicollinearity.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Check for outliers and skewness in pollutant data (e.g., CO, PM2.5).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Encode categorical variables (if any).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ensure the target variable has consistent formatting.&quot;</span>
<span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Cleanup Tasks:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cleanup_tasks</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First few rows of the dataset:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Proximity_to_Industrial_Areas</th>
      <th>Population_Density</th>
      <th>Temperature</th>
      <th>Humidity</th>
      <th>PM2_5</th>
      <th>PM10</th>
      <th>NO2</th>
      <th>SO2</th>
      <th>CO</th>
      <th>Air_Quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6.3</td>
      <td>319.0</td>
      <td>29.8</td>
      <td>59.1</td>
      <td>5.2</td>
      <td>17.9</td>
      <td>18.9</td>
      <td>9.2</td>
      <td>1.72</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6.0</td>
      <td>611.0</td>
      <td>28.3</td>
      <td>75.6</td>
      <td>2.3</td>
      <td>12.2</td>
      <td>30.8</td>
      <td>9.7</td>
      <td>1.64</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.2</td>
      <td>619.0</td>
      <td>23.1</td>
      <td>74.7</td>
      <td>26.7</td>
      <td>33.8</td>
      <td>24.4</td>
      <td>12.6</td>
      <td>1.63</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.1</td>
      <td>551.0</td>
      <td>27.1</td>
      <td>39.1</td>
      <td>6.1</td>
      <td>6.3</td>
      <td>13.5</td>
      <td>5.3</td>
      <td>1.15</td>
      <td>Good</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12.7</td>
      <td>303.0</td>
      <td>26.5</td>
      <td>70.7</td>
      <td>6.9</td>
      <td>16.0</td>
      <td>21.9</td>
      <td>5.6</td>
      <td>1.01</td>
      <td>Good</td>
    </tr>
  </tbody>
</table>
</div></div><script type="application/vnd.jupyter.widget-view+json">{"model_id": "5ec39a5f3bf44de58d5e394407b9af55", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "784b5b1e97a74558b6605b8b50721148", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "22b6fa61a8a147938872eb1a2ca9d83f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Missing Values in Each Column:
Proximity_to_Industrial_Areas    0
Population_Density               0
Temperature                      0
Humidity                         0
PM2_5                            0
PM10                             0
NO2                              0
SO2                              0
CO                               0
Air_Quality                      0
dtype: int64
</pre></div>
</div>
<img alt="_images/86a827e34b17c77cfc6dbc0b3da7f7501cdd93cbddabd5de04d4e92655e1b845.png" src="_images/86a827e34b17c77cfc6dbc0b3da7f7501cdd93cbddabd5de04d4e92655e1b845.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observations:
- Check for high correlations (e.g., PM2.5 and PM10).
- Identify missing values in certain columns.
- Check if distributions of features like CO or SO2 are skewed or capped.

Data Cleanup Tasks:
1. Handle missing values in columns with non-zero missing counts.
2. Normalize features with high variance.
3. Remove highly correlated features to avoid multicollinearity.
4. Check for outliers and skewness in pollutant data (e.g., CO, PM2.5).
5. Encode categorical variables (if any).
6. Ensure the target variable has consistent formatting.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>dagshub<span class="w"> </span>mlflow
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: dagshub in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (0.4.0)
Requirement already satisfied: mlflow in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (2.19.0)
Requirement already satisfied: PyYAML&gt;=5 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (6.0.2)
Requirement already satisfied: appdirs&gt;=1.4.4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (1.4.4)
Requirement already satisfied: click&gt;=8.0.4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (8.1.7)
Requirement already satisfied: httpx&gt;=0.23.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (0.27.2)
Requirement already satisfied: GitPython&gt;=3.1.29 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (3.1.43)
Requirement already satisfied: rich&gt;=13.1.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (13.9.4)
Collecting dacite~=1.6.0 (from dagshub)
  Using cached dacite-1.6.0-py3-none-any.whl.metadata (14 kB)
Requirement already satisfied: tenacity&gt;=8.2.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (9.0.0)
Requirement already satisfied: gql[requests] in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (3.5.0)
Requirement already satisfied: dataclasses-json in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (0.6.7)
Requirement already satisfied: pandas in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (2.2.3)
Requirement already satisfied: treelib&gt;=1.6.4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (1.7.0)
Requirement already satisfied: pathvalidate&gt;=3.0.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (3.2.1)
Requirement already satisfied: python-dateutil in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (2.9.0.post0)
Requirement already satisfied: boto3 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (1.35.84)
Requirement already satisfied: dagshub-annotation-converter&gt;=0.1.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub) (0.1.2)
Requirement already satisfied: mlflow-skinny==2.19.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (2.19.0)
Requirement already satisfied: Flask&lt;4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (3.1.0)
Requirement already satisfied: Jinja2&lt;4,&gt;=3.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (3.1.4)
Requirement already satisfied: alembic!=1.10.0,&lt;2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (1.14.0)
Requirement already satisfied: docker&lt;8,&gt;=4.0.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (7.1.0)
Requirement already satisfied: graphene&lt;4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (3.4.3)
Requirement already satisfied: markdown&lt;4,&gt;=3.3 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (3.7)
Requirement already satisfied: matplotlib&lt;4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (3.9.2)
Requirement already satisfied: numpy&lt;3 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (2.0.2)
Requirement already satisfied: pyarrow&lt;19,&gt;=4.0.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (18.1.0)
Requirement already satisfied: scikit-learn&lt;2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (1.5.2)
Requirement already satisfied: scipy&lt;2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (1.13.1)
Requirement already satisfied: sqlalchemy&lt;3,&gt;=1.4.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (2.0.36)
Requirement already satisfied: waitress&lt;4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow) (3.0.2)
Requirement already satisfied: cachetools&lt;6,&gt;=5.0.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (5.5.0)
Requirement already satisfied: cloudpickle&lt;4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (3.1.0)
Requirement already satisfied: databricks-sdk&lt;1,&gt;=0.20.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (0.39.0)
Requirement already satisfied: importlib_metadata!=4.7.0,&lt;9,&gt;=3.7.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (8.5.0)
Requirement already satisfied: opentelemetry-api&lt;3,&gt;=1.9.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (1.29.0)
Requirement already satisfied: opentelemetry-sdk&lt;3,&gt;=1.9.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (1.29.0)
Requirement already satisfied: packaging&lt;25 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (24.1)
Requirement already satisfied: protobuf&lt;6,&gt;=3.12.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (5.29.2)
Requirement already satisfied: requests&lt;3,&gt;=2.17.3 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (2.32.3)
Requirement already satisfied: sqlparse&lt;1,&gt;=0.4.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (0.5.3)
Requirement already satisfied: Mako in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from alembic!=1.10.0,&lt;2-&gt;mlflow) (1.3.8)
Requirement already satisfied: typing-extensions&gt;=4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from alembic!=1.10.0,&lt;2-&gt;mlflow) (4.12.2)
Requirement already satisfied: colorama in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from click&gt;=8.0.4-&gt;dagshub) (0.4.6)
Requirement already satisfied: lxml in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (5.3.0)
Requirement already satisfied: pillow in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (10.4.0)
Requirement already satisfied: pydantic&gt;=2.0.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (2.10.4)
Requirement already satisfied: pywin32&gt;=304 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from docker&lt;8,&gt;=4.0.0-&gt;mlflow) (306)
Requirement already satisfied: urllib3&gt;=1.26.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from docker&lt;8,&gt;=4.0.0-&gt;mlflow) (2.2.2)
Requirement already satisfied: Werkzeug&gt;=3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from Flask&lt;4-&gt;mlflow) (3.1.3)
Requirement already satisfied: itsdangerous&gt;=2.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from Flask&lt;4-&gt;mlflow) (2.2.0)
Requirement already satisfied: blinker&gt;=1.9 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from Flask&lt;4-&gt;mlflow) (1.9.0)
Requirement already satisfied: gitdb&lt;5,&gt;=4.0.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from GitPython&gt;=3.1.29-&gt;dagshub) (4.0.11)
Requirement already satisfied: graphql-core&lt;3.3,&gt;=3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from graphene&lt;4-&gt;mlflow) (3.2.5)
Requirement already satisfied: graphql-relay&lt;3.3,&gt;=3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from graphene&lt;4-&gt;mlflow) (3.2.0)
Requirement already satisfied: anyio in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (4.4.0)
Requirement already satisfied: certifi in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (2024.8.30)
Requirement already satisfied: httpcore==1.* in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (1.0.5)
Requirement already satisfied: idna in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (3.8)
Requirement already satisfied: sniffio in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (1.3.1)
Requirement already satisfied: h11&lt;0.15,&gt;=0.13 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from httpcore==1.*-&gt;httpx&gt;=0.23.0-&gt;dagshub) (0.14.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from Jinja2&lt;4,&gt;=3.0-&gt;mlflow) (2.1.5)
Requirement already satisfied: contourpy&gt;=1.0.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (1.3.0)
Requirement already satisfied: cycler&gt;=0.10 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (4.54.1)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (1.4.7)
Requirement already satisfied: pyparsing&gt;=2.3.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (3.1.4)
Requirement already satisfied: pytz&gt;=2020.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas-&gt;dagshub) (2024.2)
Requirement already satisfied: tzdata&gt;=2022.7 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pandas-&gt;dagshub) (2024.2)
Requirement already satisfied: six&gt;=1.5 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from python-dateutil-&gt;dagshub) (1.16.0)
Requirement already satisfied: markdown-it-py&gt;=2.2.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from rich&gt;=13.1.0-&gt;dagshub) (3.0.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from rich&gt;=13.1.0-&gt;dagshub) (2.18.0)
Requirement already satisfied: joblib&gt;=1.2.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from scikit-learn&lt;2-&gt;mlflow) (1.4.2)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from scikit-learn&lt;2-&gt;mlflow) (3.5.0)
Requirement already satisfied: greenlet!=0.4.17 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from sqlalchemy&lt;3,&gt;=1.4.0-&gt;mlflow) (3.1.1)
Requirement already satisfied: botocore&lt;1.36.0,&gt;=1.35.84 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from boto3-&gt;dagshub) (1.35.84)
Requirement already satisfied: jmespath&lt;2.0.0,&gt;=0.7.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from boto3-&gt;dagshub) (1.0.1)
Requirement already satisfied: s3transfer&lt;0.11.0,&gt;=0.10.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from boto3-&gt;dagshub) (0.10.4)
Requirement already satisfied: marshmallow&lt;4.0.0,&gt;=3.18.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dataclasses-json-&gt;dagshub) (3.23.1)
Requirement already satisfied: typing-inspect&lt;1,&gt;=0.4.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from dataclasses-json-&gt;dagshub) (0.9.0)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.6 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from gql[requests]-&gt;dagshub) (1.18.3)
Requirement already satisfied: backoff&lt;3.0,&gt;=1.11.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from gql[requests]-&gt;dagshub) (2.2.1)
Requirement already satisfied: requests-toolbelt&lt;2,&gt;=1.0.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from gql[requests]-&gt;dagshub) (1.0.0)
Requirement already satisfied: google-auth~=2.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (2.37.0)
Requirement already satisfied: smmap&lt;6,&gt;=3.0.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from gitdb&lt;5,&gt;=4.0.1-&gt;GitPython&gt;=3.1.29-&gt;dagshub) (5.0.1)
Requirement already satisfied: zipp&gt;=3.20 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from importlib_metadata!=4.7.0,&lt;9,&gt;=3.7.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (3.21.0)
Requirement already satisfied: mdurl~=0.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from markdown-it-py&gt;=2.2.0-&gt;rich&gt;=13.1.0-&gt;dagshub) (0.1.2)
Requirement already satisfied: deprecated&gt;=1.2.6 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from opentelemetry-api&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (1.2.15)
Requirement already satisfied: opentelemetry-semantic-conventions==0.50b0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from opentelemetry-sdk&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.50b0)
Requirement already satisfied: annotated-types&gt;=0.6.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pydantic&gt;=2.0.0-&gt;dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (0.7.0)
Requirement already satisfied: pydantic-core==2.27.2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pydantic&gt;=2.0.0-&gt;dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (2.27.2)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from requests&lt;3,&gt;=2.17.3-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (3.3.2)
Requirement already satisfied: mypy-extensions&gt;=0.3.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from typing-inspect&lt;1,&gt;=0.4.0-&gt;dataclasses-json-&gt;dagshub) (1.0.0)
Requirement already satisfied: multidict&gt;=4.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from yarl&lt;2.0,&gt;=1.6-&gt;gql[requests]-&gt;dagshub) (6.1.0)
Requirement already satisfied: propcache&gt;=0.2.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from yarl&lt;2.0,&gt;=1.6-&gt;gql[requests]-&gt;dagshub) (0.2.1)
Requirement already satisfied: wrapt&lt;2,&gt;=1.10 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from deprecated&gt;=1.2.6-&gt;opentelemetry-api&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (1.17.0)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.4.1)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (4.9)
Requirement already satisfied: pyasn1&lt;0.7.0,&gt;=0.4.6 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.6.1)
Using cached dacite-1.6.0-py3-none-any.whl (12 kB)
Installing collected packages: dacite
  Attempting uninstall: dacite
    Found existing installation: dacite 1.8.1
    Uninstalling dacite-1.8.1:
      Successfully uninstalled dacite-1.8.1
Successfully installed dacite-1.6.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
ydata-profiling 4.12.1 requires dacite&gt;=1.8, but you have dacite 1.6.0 which is incompatible.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dagshub</span>
<span class="n">dagshub</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">repo_owner</span><span class="o">=</span><span class="s1">&#39;saket027&#39;</span><span class="p">,</span> <span class="n">repo_name</span><span class="o">=</span><span class="s1">&#39;EAS_503_Updated_Air_Quality_Prediction&#39;</span><span class="p">,</span> <span class="n">mlflow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Accessing as saket027
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Initialized MLflow to track repo <span style="color: #008000; text-decoration-color: #008000">"saket027/EAS_503_Updated_Air_Quality_Prediction"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Repository saket027/EAS_503_Updated_Air_Quality_Prediction initialized!
</pre>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># Load the dataset from Step-2 output</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your actual file name</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">])</span>  <span class="c1"># Replace with your target variable name if different</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Poor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Hazardous&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># Define preprocessing pipeline</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="n">numerical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># Log transformation</span>
<span class="p">])</span>

<span class="n">categorical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_pipeline</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_pipeline</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Define the Logistic Regression pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Define custom scoring metrics</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;f1_macro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
    <span class="s2">&quot;f1_micro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Configure MLflow with your DagsHub credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;saket027&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;553f4ee6bcede3c7f7f8eb2c08404b0ad4209b2e&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment_1_logistic_regression&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Perform cross-validation</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Log F1-scores to MLflow</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>

    <span class="c1"># Fit the pipeline on the full training data</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Log confusion matrix on the full training data</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">cm</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;true_positive&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;true_negative&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;false_positive&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;false_negative&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

    <span class="c1"># Hyperparameter tuning</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;classifier__C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>  <span class="c1"># Example regularization parameters</span>
        <span class="s2">&quot;classifier__solver&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lbfgs&quot;</span><span class="p">,</span> <span class="s2">&quot;liblinear&quot;</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;f1_macro&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Log hyperparameter tuning results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_C&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__C&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_solver&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__solver&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;best_f1_macro&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>

    <span class="c1"># Log the model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="s2">&quot;logistic_regression_pipeline&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment logged in MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/19 17:12:44 INFO mlflow.tracking.fluent: Experiment with name &#39;Experiment_1_logistic_regression&#39; does not exist. Creating a new experiment.
2024/12/19 17:12:49 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment logged in MLflow.
🏃 View run gentle-grouse-618 at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/1/runs/faf22efcff0648cab4340a0fa08119cb
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">xgboost</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: xgboost in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (2.1.3)
Requirement already satisfied: numpy in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from xgboost) (2.0.2)
Requirement already satisfied: scipy in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from xgboost) (1.13.1)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Experiment-2</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="c1"># Load the dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your actual file name</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">])</span>  <span class="c1"># Replace with your target variable name if different</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Poor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Hazardous&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># Define preprocessing pipeline</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="n">numerical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># Log transformation</span>
<span class="p">])</span>

<span class="n">categorical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_pipeline</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_pipeline</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Define classifiers</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;RidgeClassifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="c1"># Remove deprecated parameter use_label_encoder</span>
    <span class="s2">&quot;XGBClassifier&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;mlogloss&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Configure MLflow with your DagsHub credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;saket027&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;553f4ee6bcede3c7f7f8eb2c08404b0ad4209b2e&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;experiment_2_multiple_classifiers&quot;</span><span class="p">)</span>

<span class="c1"># Scoring</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;f1_macro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
    <span class="s2">&quot;f1_micro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># We will use a single sample from X to infer model signature and provide input_example</span>
<span class="n">input_example</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
        <span class="c1"># Create a pipeline with the current classifier</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">classifier</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="c1"># Perform cross-validation</span>
        <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Log metrics</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>

        <span class="c1"># Fit the pipeline on the full dataset to log the model</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Infer model signature</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">input_example</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_example</span><span class="p">))</span>

        <span class="c1"># Log the model with input_example and signature</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> 
            <span class="n">artifact_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_pipeline&quot;</span><span class="p">,</span>
            <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span> 
            <span class="n">signature</span><span class="o">=</span><span class="n">signature</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> logged in MLflow with signature and input example.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1a343c61d7cd4817b63ba0cc4bccb59f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment for LogisticRegression logged in MLflow with signature and input example.
🏃 View run LogisticRegression at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/2/runs/ab1998fb6172499bb0d193d6c88c572e
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "eea98e032d5143099a827e62649db60a", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment for RidgeClassifier logged in MLflow with signature and input example.
🏃 View run RidgeClassifier at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/2/runs/d667b7ef095648848854a837869b8b60
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "57233767da344386af050a11ce0d07f0", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment for RandomForestClassifier logged in MLflow with signature and input example.
🏃 View run RandomForestClassifier at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/2/runs/6031bbb4b191493a8c6db10c3d4cca3f
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "db175b9125464c5293f0b5983797a185", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment for XGBClassifier logged in MLflow with signature and input example.
🏃 View run XGBClassifier at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/2/runs/6ffda4e422954c03b7a1a34418876950
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Experiment-3</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="c1"># Load the dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with the actual file name</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">])</span>  <span class="c1"># Replace with your target column if different</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Poor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Hazardous&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># Define a custom transformer for feature engineering</span>
<span class="c1"># Example: Create new features like PM_Ratio = PM2.5 / (PM10+1), NO2_SO2_Ratio = NO2/(SO2+1), </span>
<span class="c1"># and an interaction feature like Temp_Humidity = Temperature * Humidity.</span>
<span class="k">class</span> <span class="nc">FeatureEngineering</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Ensure columns exist before creating ratios</span>
        <span class="k">if</span> <span class="s2">&quot;PM2.5&quot;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;PM10&quot;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;PM_Ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;PM2.5&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;PM10&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">)</span>  <span class="c1"># Avoid division by zero</span>
        
        <span class="k">if</span> <span class="s2">&quot;NO2&quot;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;SO2&quot;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;NO2_SO2_Ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;NO2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;SO2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s2">&quot;Temperature&quot;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;Humidity&quot;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;Temperature_Humidity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;Temperature&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;Humidity&quot;</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">X</span>

<span class="c1"># Identify numerical and categorical features after original data loaded</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Numerical preprocessing pipeline</span>
<span class="n">numerical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Categorical preprocessing pipeline</span>
<span class="n">categorical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Full preprocessing pipeline</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_pipeline</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_pipeline</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Combine feature engineering and preprocessing into one pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;feature_engineering&quot;</span><span class="p">,</span> <span class="n">FeatureEngineering</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Define scoring</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;f1_macro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
    <span class="s2">&quot;f1_micro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Configure MLflow with your DagsHub credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;saket027&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;553f4ee6bcede3c7f7f8eb2c08404b0ad4209b2e&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;experiment_3_feature_engineering&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Perform cross-validation</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>

    <span class="c1"># Fit the pipeline on the full dataset to log the model</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Create a single-row input example for signature inference</span>
    <span class="n">input_example</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">input_example</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_example</span><span class="p">))</span>

    <span class="c1"># Log the model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span> 
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;feature_engineered_pipeline&quot;</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span> 
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment #3 logged in MLflow with feature engineering.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/19 17:33:55 INFO mlflow.tracking.fluent: Experiment with name &#39;experiment_3_feature_engineering&#39; does not exist. Creating a new experiment.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c6e0d87ca4e940949e74ae18512f8e61", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment #3 logged in MLflow with feature engineering.
🏃 View run stylish-snake-431 at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/3/runs/5d9da453bd1f4500b912d1fe0dbdc6f7
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Experiment-4</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span><span class="p">,</span> <span class="n">SelectFromModel</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="c1"># Custom transformer to remove correlated features</span>
<span class="k">class</span> <span class="nc">CorrelationFilter</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_to_drop_</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Calculate correlation matrix</span>
        <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        
        <span class="c1"># Upper triangle of correlation matrix</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>
        
        <span class="c1"># Find features to drop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_to_drop_</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features_to_drop_</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Load the dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your actual file name</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">])</span>  <span class="c1"># Replace if target differs</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Poor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Hazardous&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># Identify numerical and categorical features</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Numerical preprocessing pipeline</span>
<span class="n">numerical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Categorical preprocessing pipeline</span>
<span class="n">categorical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Preprocessing pipeline</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_pipeline</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_pipeline</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Feature selection steps:</span>
<span class="c1"># 1. VarianceThreshold</span>
<span class="c1"># 2. CorrelationFilter (custom transformer)</span>
<span class="c1"># 3. SelectFromModel (RandomForest) for feature importance</span>
<span class="n">feature_selection</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;var_thresh&quot;</span><span class="p">,</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;corr_filter&quot;</span><span class="p">,</span> <span class="n">CorrelationFilter</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Final pipeline with Logistic Regression</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">,</span> <span class="n">feature_selection</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Scoring</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;f1_macro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
    <span class="s2">&quot;f1_micro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Configure MLflow with DagsHub credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;saket027&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;553f4ee6bcede3c7f7f8eb2c08404b0ad4209b2e&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;experiment_4_feature_selection&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Perform cross-validation</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>

    <span class="c1"># Fit the pipeline on full data to log the model</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Create an input example for model signature</span>
    <span class="n">input_example</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">input_example</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_example</span><span class="p">))</span>

    <span class="c1"># Log the model with signature and input example</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;feature_selection_pipeline&quot;</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment #4 logged in MLflow with feature selection steps.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/19 17:46:45 INFO mlflow.tracking.fluent: Experiment with name &#39;experiment_4_feature_selection&#39; does not exist. Creating a new experiment.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "016c79dd879945a4a1b4dfce098431a4", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment #4 logged in MLflow with feature selection steps.
🏃 View run zealous-gnu-171 at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/4/runs/0b21ea94d31c47f9bc33e7af7ec8ae65
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="c1"># Load the dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with the correct file name</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">])</span>  <span class="c1"># Adjust if target differs</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Poor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Hazardous&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># Identify numerical and categorical features</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Numerical pipeline</span>
<span class="n">numerical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Categorical pipeline</span>
<span class="n">categorical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Preprocessing</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_pipeline</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_pipeline</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Configure MLflow with your DagsHub credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;saket027&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;553f4ee6bcede3c7f7f8eb2c08404b0ad4209b2e&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;experiment_5_pca&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Preprocess the data to fit PCA</span>
    <span class="n">X_pre</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Fit PCA to determine explained variance</span>
    <span class="n">pca_full</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
    <span class="n">pca_full</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_pre</span><span class="p">)</span>
    <span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca_full</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
    <span class="n">cumulative_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span>

    <span class="c1"># Create scree plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cumulative_variance</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cumulative Variance&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">explained_variance_ratio</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Explained Variance Ratio&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Principal Component&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Explained Variance Ratio&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Scree Plot&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Save and show the scree plot inline</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;scree_plot.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;scree_plot.png&quot;</span><span class="p">)</span>

    <span class="c1"># Select number of components that explain at least 95% variance</span>
    <span class="n">n_components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_variance</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># Create a pipeline with PCA using selected components</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>

    <span class="c1"># Scoring metrics</span>
    <span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;f1_macro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
        <span class="s2">&quot;f1_micro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># Perform cross-validation</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>

    <span class="c1"># Fit pipeline on entire dataset</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Create input_example and signature</span>
    <span class="n">input_example</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">input_example</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_example</span><span class="p">))</span>

    <span class="c1"># Log the model with MLflow</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;pca_pipeline&quot;</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span>
    <span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;n_components&quot;</span><span class="p">,</span> <span class="n">n_components</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment #5 logged in MLflow. PCA chose </span><span class="si">{</span><span class="n">n_components</span><span class="si">}</span><span class="s2"> components.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/19 17:55:32 INFO mlflow.tracking.fluent: Experiment with name &#39;experiment_5_pca&#39; does not exist. Creating a new experiment.
</pre></div>
</div>
<img alt="_images/01b80b69e5826037362eab7d3a2cfe7f41d8903ca5672103179a0a7b9dff5e0b.png" src="_images/01b80b69e5826037362eab7d3a2cfe7f41d8903ca5672103179a0a7b9dff5e0b.png" />
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "41758675e44b40909be9502320f46015", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment #5 logged in MLflow. PCA chose 7 components.
🏃 View run sassy-roo-165 at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/5/runs/e57a9ec863ff4bbb9d33a6fd1f59aa71
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Eperiment-6</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>

<span class="c1"># Load data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your actual file name</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">])</span>  <span class="c1"># Adjust if target differs</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Poor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Hazardous&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># Identify numerical and categorical features</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Numerical pipeline</span>
<span class="n">numerical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>  <span class="c1"># Log transform</span>
    <span class="p">(</span><span class="s2">&quot;poly&quot;</span><span class="p">,</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">interaction_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Categorical pipeline</span>
<span class="n">categorical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Preprocessing</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_pipeline</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_pipeline</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Define the classifier (Custom choice: GradientBoostingClassifier)</span>
<span class="n">classifier_GradientBoosting</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Full pipeline</span>
<span class="n">gb_classifier</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">classifier_GradientBoosting</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Scoring</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;f1_macro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
    <span class="s2">&quot;f1_micro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Configure MLflow with DagsHub credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;saket027&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;553f4ee6bcede3c7f7f8eb2c08404b0ad4209b2e&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment_6_custom&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Perform cross-validation</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">gb_classifier</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>

    <span class="c1"># Fit on full data</span>
    <span class="n">gb_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Create input_example and signature</span>
    <span class="n">input_example</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">input_example</span><span class="p">,</span> <span class="n">gb_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_example</span><span class="p">))</span>

    <span class="c1"># Log model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">gb_classifier</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;custom_experiment_pipeline&quot;</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span>
    <span class="p">)</span>

    <span class="c1"># Log parameters (e.g., polynomial degree)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;polynomial_degree&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment #6 (Custom) logged in MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1cb07456914d4e20a24ba1e0cc11cc9e", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment #6 (Custom) logged in MLflow.
🏃 View run gregarious-frog-959 at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/7/runs/0db3fe7b1a274431a51e981bc695ccfc
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/7
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">lightgbm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting lightgbm
  Downloading lightgbm-4.5.0-py3-none-win_amd64.whl.metadata (17 kB)
Requirement already satisfied: numpy&gt;=1.17.0 in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from lightgbm) (2.0.2)
Requirement already satisfied: scipy in c:\users\saket\appdata\local\programs\python\python312\lib\site-packages (from lightgbm) (1.13.1)
Downloading lightgbm-4.5.0-py3-none-win_amd64.whl (1.4 MB)
   ---------------------------------------- 0.0/1.4 MB ? eta -:--:--
   ---------------------------------------- 1.4/1.4 MB 15.2 MB/s eta 0:00:00
Installing collected packages: lightgbm
Successfully installed lightgbm-4.5.0
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Experiment - 7</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">mutual_info_classif</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">make_scorer</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>

<span class="c1"># Custom transformer for mutual information-based feature selection</span>
<span class="k">class</span> <span class="nc">MutualInfoFeatureSelector</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_indices_</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c1"># Compute mutual information between features and target</span>
        <span class="n">mi_scores</span> <span class="o">=</span> <span class="n">mutual_info_classif</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
        <span class="c1"># Select top k features based on mutual information scores</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_indices_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">mi_scores</span><span class="p">)[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_indices_</span><span class="p">]</span>

<span class="c1"># Load the dataset from Step-2</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_from_step_2.csv&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your actual file name</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">])</span>  <span class="c1"># Adjust if target differs</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Air_Quality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Poor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Hazardous&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># Identify numerical and categorical features</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Numerical pipeline</span>
<span class="n">numerical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Categorical pipeline</span>
<span class="n">categorical_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Preprocessing pipeline</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_pipeline</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_pipeline</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Choose the number of features to select</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Define scoring</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;f1_macro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
    <span class="s2">&quot;f1_micro&quot;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Create pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;feature_selector&quot;</span><span class="p">,</span> <span class="n">MutualInfoFeatureSelector</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Configure MLflow with DagsHub credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;saket027&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;553f4ee6bcede3c7f7f8eb2c08404b0ad4209b2e&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;experiment_7_custom&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Perform cross-validation</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_macro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_macro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_micro_std&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1_micro&quot;</span><span class="p">]))</span>

    <span class="c1"># Fit on full data</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Create input_example and signature</span>
    <span class="n">input_example</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">prediction_example</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_example</span><span class="p">)</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">input_example</span><span class="p">,</span> <span class="n">prediction_example</span><span class="p">)</span>

    <span class="c1"># Log model with MLflow</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span>
        <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;mutual_info_pipeline_lgbm&quot;</span><span class="p">,</span>
        <span class="n">input_example</span><span class="o">=</span><span class="n">input_example</span><span class="p">,</span>
        <span class="n">signature</span><span class="o">=</span><span class="n">signature</span>
    <span class="p">)</span>

    <span class="c1"># Log parameters (e.g., K)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;selected_features_k&quot;</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment #7 (Another Custom Experiment) logged in MLflow with mutual info feature selection and LGBMClassifier.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000149 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2191
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000254 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2191
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000142 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2194
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000143 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2195
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000274 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2195
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000128 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2190
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000140 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2190
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000261 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2194
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000368 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2192
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000157 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2193
[LightGBM] [Info] Number of data points in the train set: 4500, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000144 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 2195
[LightGBM] [Info] Number of data points in the train set: 5000, number of used features: 9
[LightGBM] [Info] Start training from score -0.916291
[LightGBM] [Info] Start training from score -1.203973
[LightGBM] [Info] Start training from score -1.609438
[LightGBM] [Info] Start training from score -2.302585
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a91ced2cc2df42eb9af157594d55743f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment #7 (Another Custom Experiment) logged in MLflow with mutual info feature selection and LGBMClassifier.
🏃 View run colorful-horse-172 at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/8/runs/e9884219290b429d8eea7dcc0b707de2
🧪 View experiment at: https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow/#/experiments/8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Configure MLflow with your DagsHub credentials</span>
<span class="n">MLFLOW_TRACKING_URI</span> <span class="o">=</span> <span class="s2">&quot;https://dagshub.com/saket027/EAS_503_Updated_Air_Quality_Prediction.mlflow&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;saket027&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;553f4ee6bcede3c7f7f8eb2c08404b0ad4209b2e&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">MLFLOW_TRACKING_URI</span><span class="p">)</span>

<span class="c1"># List of experiment names (replace if needed)</span>
<span class="n">experiment_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Experiment_1_logistic_regression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment_2_multiple_classifiers&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment_3_feature_engineering&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment_4_feature_selection&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment_5_pca&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Experiment_6_custom&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment_7_custom&quot;</span>
<span class="p">]</span>

<span class="c1"># Initialize a DataFrame to store results</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Experiment&quot;</span><span class="p">,</span> <span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">,</span> <span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">exp_name</span> <span class="ow">in</span> <span class="n">experiment_names</span><span class="p">:</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">get_experiment_by_name</span><span class="p">(</span><span class="n">exp_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment &#39;</span><span class="si">{</span><span class="n">exp_name</span><span class="si">}</span><span class="s2">&#39; not found. Skipping.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="n">runs</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">search_runs</span><span class="p">(</span><span class="n">experiment_ids</span><span class="o">=</span><span class="p">[</span><span class="n">exp</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">runs</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No runs found for &#39;</span><span class="si">{</span><span class="n">exp_name</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Check if metrics are present</span>
    <span class="k">if</span> <span class="s2">&quot;metrics.f1_macro_mean&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">runs</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;metrics.f1_micro_mean&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">runs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;f1_macro_mean&#39; or &#39;f1_micro_mean&#39; not found for &#39;</span><span class="si">{</span><span class="n">exp_name</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Convert to numeric</span>
    <span class="n">runs</span><span class="p">[</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="s2">&quot;metrics.f1_macro_mean&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="n">runs</span><span class="p">[</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="s2">&quot;metrics.f1_micro_mean&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">runs</span><span class="p">[</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">or</span> <span class="n">runs</span><span class="p">[</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No valid f1_macro_mean or f1_micro_mean for &#39;</span><span class="si">{</span><span class="n">exp_name</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Select the best run by f1_macro_mean</span>
    <span class="n">best_run_idx</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
    <span class="n">best_run</span> <span class="o">=</span> <span class="n">runs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_run_idx</span><span class="p">]</span>

    <span class="n">f1_macro_mean</span> <span class="o">=</span> <span class="n">best_run</span><span class="p">[</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">]</span>
    <span class="n">f1_micro_mean</span> <span class="o">=</span> <span class="n">best_run</span><span class="p">[</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">]</span>

    <span class="c1"># Add the results to DataFrame</span>
    <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">exp_name</span><span class="p">,</span> <span class="n">f1_macro_mean</span><span class="p">,</span> <span class="n">f1_micro_mean</span><span class="p">]</span>

<span class="c1"># Check if we have any results</span>
<span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No experiments with valid runs found.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aggregated Results:&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="c1"># Plot the F1-scores as a comparison bar chart</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">],</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;skyblue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;F1-Macro Mean&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="n">i</span> <span class="o">+</span> <span class="n">bar_width</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">],</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;F1-Micro Mean&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Experiments&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of F1 Scores Across Experiments&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span> <span class="o">+</span> <span class="n">bar_width</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;Experiment&quot;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Determine best model by each metric</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">best_f1_macro_experiment</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;f1_macro_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s2">&quot;Experiment&quot;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best model by f1_macro_mean: </span><span class="si">{</span><span class="n">best_f1_macro_experiment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">best_f1_micro_experiment</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;f1_micro_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s2">&quot;Experiment&quot;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best model by f1_micro_mean: </span><span class="si">{</span><span class="n">best_f1_micro_experiment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Aggregated Results:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Experiment</th>
      <th>f1_macro_mean</th>
      <th>f1_micro_mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Experiment_1_logistic_regression</td>
      <td>0.892077</td>
      <td>0.9250</td>
    </tr>
    <tr>
      <th>1</th>
      <td>experiment_2_multiple_classifiers</td>
      <td>0.933326</td>
      <td>0.9554</td>
    </tr>
    <tr>
      <th>2</th>
      <td>experiment_3_feature_engineering</td>
      <td>0.892077</td>
      <td>0.9250</td>
    </tr>
    <tr>
      <th>3</th>
      <td>experiment_4_feature_selection</td>
      <td>0.852230</td>
      <td>0.8972</td>
    </tr>
    <tr>
      <th>4</th>
      <td>experiment_5_pca</td>
      <td>0.889305</td>
      <td>0.9218</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Experiment_6_custom</td>
      <td>0.933305</td>
      <td>0.9558</td>
    </tr>
    <tr>
      <th>6</th>
      <td>experiment_7_custom</td>
      <td>0.933196</td>
      <td>0.9544</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="_images/7f669080ae12d5b6506d7b4b2ad855be00fbaebd1ca77ebb0e7920bcdfc94417.png" src="_images/7f669080ae12d5b6506d7b4b2ad855be00fbaebd1ca77ebb0e7920bcdfc94417.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best model by f1_macro_mean: experiment_2_multiple_classifiers
Best model by f1_micro_mean: Experiment_6_custom
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Assuming &#39;pipeline&#39; is your best model (already trained)</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">gb_classifier</span><span class="p">,</span> <span class="s2">&quot;gradient_boost_v1.pk1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best model from Experiment 6 saved&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best model from Experiment 6 saved
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_model_reloaded</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;gradient_boost_v1.pk1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Saket Medhalavalasa</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>